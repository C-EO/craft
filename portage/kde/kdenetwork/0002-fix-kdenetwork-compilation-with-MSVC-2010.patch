>From cc6a7749447938ed9ab0df43e4bdfc1b7b8b287e Mon Sep 17 00:00:00 2001
From: Nico Kruber <nico.kruber@gmail.com>
Date: Sat, 20 Apr 2013 16:56:12 +0200
Subject: [PATCH 2/2] fix kdenetwork compilation with MSVC 2010

---
 portage/kde/kdenetwork/kdenetwork-20080202.py              |  1 +
 .../kdenetwork-4.10.2-fix-MSVC2010-compile.patch           | 14 ++++++++++++++
 2 files changed, 15 insertions(+)
 create mode 100644 portage/kde/kdenetwork/kdenetwork-4.10.2-fix-MSVC2010-compile.patch

diff --git a/portage/kde/kdenetwork/kdenetwork-20080202.py b/portage/kde/kdenetwork/kdenetwork-20080202.py
index bba5053..234915f 100644
--- a/portage/kde/kdenetwork/kdenetwork-20080202.py
+++ b/portage/kde/kdenetwork/kdenetwork-20080202.py
@@ -7,6 +7,7 @@ class subinfo(info.infoclass):
             self.targets[kd.kdeversion + ver] = "http://download.kde.org/stable/" + kd.kdeversion + ver + "/src/" + self.package + "-" + kd.kdeversion + ver + ".tar.xz"
             self.targetInstSrc[kd.kdeversion + ver] = self.package + '-' + kd.kdeversion + ver
         self.patchToApply['4.10.1'] = [("kdenetwork-4.8.0-20120125.diff", 1)]
+        self.patchToApply['4.10.2'] = [("kdenetwork-4.10.2-fix-MSVC2010-compile.patch", 1)]
 
         if kd.kdebranch == 'master':
             self.svnTargets['svnHEAD'] = 'trunk/KDE/%s' % self.package
diff --git a/portage/kde/kdenetwork/kdenetwork-4.10.2-fix-MSVC2010-compile.patch b/portage/kde/kdenetwork/kdenetwork-4.10.2-fix-MSVC2010-compile.patch
new file mode 100644
index 0000000..9bb2040
--- /dev/null
+++ b/portage/kde/kdenetwork/kdenetwork-4.10.2-fix-MSVC2010-compile.patch
@@ -0,0 +1,14 @@
+diff -Nru -x '*~' kdenetwork-4.10.2.orig/kget/core/transferhistorystore.cpp kdenetwork-4.10.2/kget/core/transferhistorystore.cpp
+--- kdenetwork-4.10.2.orig/kget/core/transferhistorystore.cpp	2013-03-29 08:11:01.565524300 +0100
++++ kdenetwork-4.10.2/kget/core/transferhistorystore.cpp	2013-04-20 16:50:01.378485100 +0200
+@@ -554,7 +554,9 @@
+ void NepomukStore::load()
+ {
+     Nepomuk::Query::QueryServiceClient * queryService = new Nepomuk::Query::QueryServiceClient(this);
+-    Nepomuk::Query::ResourceTypeTerm historyTypeTerm(Nepomuk::Types::Class(Nepomuk::HistoryItem::resourceTypeUri()));
++    const QUrl& resourceTypeUri = Nepomuk::HistoryItem::resourceTypeUri();
++    Nepomuk::Types::Class resourceTypeClass(resourceTypeUri); // attention: do not place inline - or MSVC 2010 (maybe more versions) fails
++    Nepomuk::Query::ResourceTypeTerm historyTypeTerm(resourceTypeClass);
+     Nepomuk::Query::Query historyQuery(historyTypeTerm);
+ 
+     connect(queryService, SIGNAL(newEntries(const QList<Nepomuk::Query::Result>&)), this, SLOT(loadResult(const QList<Nepomuk::Query::Result>&)));
-- 
1.8.0.msysgit.0

